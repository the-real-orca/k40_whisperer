<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Picnic CSS -->
	<link rel="stylesheet" href="libs/css/picnic.min.css">

    <!-- Icons -->
	<link rel="stylesheet" href="libs/css/laser-font.css">

	<!-- Zepto -->
	<script type='text/javascript' src='libs/js/zepto.min.js'></script>

	<!-- WebSockets -->
	<script type="text/javascript" src="libs/js/socket.io.slim.js"></script>

	<!-- Knockout.js MVVM -->
	<script type='text/javascript' src='libs/js/knockout-3.4.2.js'></script>
	<script type='text/javascript' src='libs/js/knockout.mapping-2.4.1.js'></script>

	<!-- Tabs -->
	<link rel="stylesheet" href="tabs.css">

	<!-- Messages -->
	<link rel="stylesheet" href="msg.css">
	<script src="msg.js"></script>


	<!--  -->
	<link rel="stylesheet" href="main.css">
	<script type='text/javascript' src='main.js'></script>

</head>
<body>

	<!-- header -->
	<div class="header">
		<div class="title">
			<!-- <img class="TODO logo" src="" alt="Logo"/> -->
			<h1>Laser Whisperer</h1>
		</div>
		<div class="status">
			<span class="dangerous" data-bind="css: { ok: status.laser, error: alert.laser }"><i class="icon-laser"></i></span>
			<span data-bind="css: { ok: status.airassist, error: alert.airassist }"><i class="icon-fan"></i> <span data-bind="text: status.airassist" class="unit percent"></span></span>

			<span data-bind="css: { ok: status.waterTemp, error: alert.waterTemp }"><i class="icon-thermometer"></i> <span data-bind="text: status.waterTemp" class="unit temp"></span></span>
			<span data-bind="css: { ok: status.waterFlow, error: alert.waterFlow }"><i class="icon-air"></i> <span data-bind="text: status.waterFlow" class="unit flowrate"></span></span>

			<span data-bind="css: { ok: status.usb, error: alert.usb }" ><i class="icon-usb"></i></span>
			<span data-bind="css: { ok: status.network, error: alert.network }" ><i data-bind="css: status.networkIcon"></i></span>
		</div>
	</div>

	<!-- message stack -->
	<div class="flex">
		<div id="stack" class="right message-stack half-700 third-1000" data-bind="template: {foreach: msgList, afterAdd: fxFadeIn, beforeRemove: fxSlideUpRemove}">
			<article class="card message" data-bind="css: type">
			  <header><span data-bind="html: header"></span><span class="close">
					<span data-bind="visible: timeoutHandle, click: removeTimeout">
						<span class="timeout" data-bind="style: { animationDuration: timeout+'s'}"></span> <b>&#9684;</b>
					</span>
					&nbsp; <b data-bind="click: remove">&times;</b>
				</span></header>
			  <section data-bind="html: text"></section>
			</article>
		</div>
	</div>

	<!-- main content -->
	<div class="tabs side-right">

		<!-- Workspace -->
		<input id="Workspace" name="mainTabsGroup" type="radio" checked />
		<label class="title" for="Workspace"><i class="icon-picture"></i></label>
		<div class="content center" >
			<div class="flex">
				<div class="workspace">
	<!--
					<svg viewBox="0 0 320 200" width="100%" height="100%">
						<path stroke="black" fill="cyan" d="M 0,0 L 320,0 L 320,200 L 0,200 z"/>
						<path fill="red"  d="M 0,0 L 320,0 L 160,200 z"/>
						<path stroke="black" fill="none" d="M 160,0 L 260,100 L 160,200 L 60,100 z"/>
					</svg>
	-->				
					<svg data-bind="attr: {viewBox: '0 0 '+workspace.width()+' '+workspace.height()}"  width="100%" height="100%" preserveAspectRatio="xMidYMin meet">
						<rect data-bind="attr: {width: workspace.width(), height: workspace.height()}" id="canvasRect" />
						<defs><clipPath id="clip"><use xlink:href="#canvasRect"/></clipPath></defs>
		
						<use href="images/origin.svg#origin" data-bind="attr: {x: workspace.drawingsOrigin.x, y: workspace.drawingsOrigin.y}"></use>
						<g data-bind="foreach: workspace.drawings"  clip-path="url(#clip)">
							<use data-bind="attr: {href: url()+'#root', x: x, y: y}"></use>
						</g>
					</svg>
				</div>
				<div class="workspaceControl">
					<form method="post" enctype="multipart/form-data" action="upload">
						<label class="upload button icon-folder-open large">
							<input id="uploadFile" title="drop file or click me" name="file" type="file" ></input>
						</label>
						<input id="uploadSubmit" type="submit"></input>
					</form>
					<div>
						<label for="dialog_element" class="button icon-layers large"></label>
					</div>
					<div>
						<button class="error icon-trash large" data-bind="click: workspaceClear"></button>
					</div>
				</div>
			</div>
		</div>


		<!-- Position -->
		<input id="Position" name="mainTabsGroup" type="radio"/>
		<label class="title" for="Position"><i class="icon-move"></i></label>
		<div class="content center">
			<div class="flex four">
				<div class="position">
					<div>
						<b>X:</b> <input type="number" data-bind="numericValue: pos.x, precision: 2, enable: pos.valid"></input><span class="unit pos"></span>
					</div>
					<div>
						<b>Y:</b> <input type="number" data-bind="numericValue: pos.y, precision: 2, enable: pos.valid"></input><span class="unit pos"></span>
					</div>
					<hr>
					<button class="success" data-bind="click: initLaser, visible: !status.usb()"><i class="icon-off"></i> Init</button>
					<button data-bind="click: releaseLaser, visible: status.usb()"><i class="icon-off"></i> Release</button>
					<button data-bind="css: {success: !pos.valid()}, click: home, enable: status.usb"><i class="icon-home"></i> Home</button>
					<button data-bind="click: unlock, enable: status.usb"><i class="icon-eject"></i> Unlock</button>
					<button data-bind="click: stop, enable: status.usb" class="error"><i class="icon-close-octagon"></i> Stop</button>
				</div>
				<div class="three-fourth">
					<table class="move">
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toUp icon-move_fast" data-bind="click: move.bind($data, 0, $root.config.stepSize()*10 ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toUp icon-move_std" data-bind="click: move.bind($data, 0, $root.config.stepSize() ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toUp icon-move_slow" data-bind="click: move.bind($data, 0, $root.config.stepSize()/10 ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
						<tr>
							<td><button class="move toLeft icon-move_fast" data-bind="click: move.bind($data, -$root.config.stepSize()*10, 0), enable: status.usb"></button></td>
							<td><button class="move toLeft icon-move_std" data-bind="click: move.bind($data, -$root.config.stepSize(), 0), enable: status.usb"></button></td>
							<td><button class="move toLeft icon-move_slow" data-bind="click: move.bind($data, -$root.config.stepSize()/10, 0), enable: status.usb"></button></td>
							<td>
								<label class="TODO anchorPos flat"><!-- center -->
									<b>&#9587;</b>
									<input type="radio" value="center" name="anchorPos" data-bind="checked: anchor"></input>
								</label>
							</td>
							<td><button class="move toRight icon-move_slow" data-bind="click: move.bind($data, $root.config.stepSize()/10, 0), enable: status.usb"></button></td>
							<td><button class="move toRight icon-move_std" data-bind="click: move.bind($data, $root.config.stepSize(), 0), enable: status.usb"></button></td>
							<td><button class="move toRight icon-move_fast" data-bind="click: move.bind($data, $root.config.stepSize()*10, 0), enable: status.usb"></button></td>
						</tr>
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toDown icon-move_slow" data-bind="click: move.bind($data, 0, -$root.config.stepSize()/10 ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toDown icon-move_std" data-bind="click: move.bind($data, 0, -$root.config.stepSize() ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
						<tr>
							<td></td><td></td><td></td>
							<td><button class="move toDown icon-move_fast" data-bind="click: move.bind($data, 0, -$root.config.stepSize()*10 ), enable: status.usb"></button></td>
							<td></td><td></td><td></td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<!-- Process -->
		<input id="Process" name="mainTabsGroup" type="radio" />
		<label class="title" for="Process"><i class="icon-fire"></i></label>
		<div class="content center">
<!--
			<div class="full two-third-800 panel">
				 <fieldset class="panel">
					<legend>live image</legend>
					<img class="liveImage" label="Live image from laser encraver" >
				</fieldset>
			</div>
-->
			<div class="flex center four-500">
				<div >
					<button class="success" data-bind="click: initLaser, visible: !status.usb()"><i class="icon-off"></i> Init</button>
					<button data-bind="click: releaseLaser, visible: status.usb"><i class="icon-off"></i> Release</button>
				</div>
				<div >
					<button data-bind="css: {success: !pos.valid()}, click: home, enable: status.usb"><i class="icon-crosshairs-gps"></i> Home</button>
				</div>
				<div >
					<button data-bind="click: unlock, enable: status.usb"><i class="icon-eject"></i> Unlock</button>
				</div>
				<div >
					<button data-bind="click: stop, enable: status.usb" class="error"><i class="icon-close-octagon"></i> Stop</button>
				</div>
			</div>
			<hr>
			<div class="flex two">
				<div>
					<table class="" data-bind="foreach: tasks">
						<tr class="task">
							<td>
							<!--
								<label>
									<input type="checkbox" checked><span class="checkable"></span>
								</label>
							-->
							</td>
							<td>
								<label for="dialog_taskSettings" class="flat button" data-bind="click: ()=>{$root.selectedTask($data);return true}"><span data-bind="text: name"></span> <i class="icon-sliders"></i></label>
							</td>
							<td>
								<button class="flat right" data-bind="click: ()=>{taskRun($data.id())}"><i class="icon-play"></i></button>
							</td>
						</tr>
					</table>
				</div>
				<div>
					<button class="right" data-bind="click: taskRunAll"><i class="icon-play"></i></button>
				</div>
			</div>
		</div>
	</div>

	<!--
	<div id="menu">
		<button class="flat gray icon-resize-full" data-bind="click: fullscreen"></button>
	</div>
	-->
	
	<!-- ------------------------------------------------------------------------------ -->
	
	<!-- fullscreen dialog -->
	<div class="modal">
		<input id="dialog_fullscreen" type="checkbox" data-bind="checked: dialog.fullscreen" />
		<label for="dialog_fullscreen" class="overlay"></label>
		<article>
			<header>
				<h3>small display detected</h3>
				<label for="dialog_fullscreen" class="close">&times;</label>
			</header>
			<section class="center">
				<br>
				<label for="dialog_fullscreen" class="button success large" data-bind="click: ()=>{fullscreen(); return true}">Full Screen Mode</label><br>
				<br>
				<label for="dialog_fullscreen" class="button">Browser Mode</label><br>
				<br>
			</section>
		</article>
	</div>

	<!-- element dialog -->
	<div class="modal">
		<input id="dialog_element" type="checkbox" />
		<label for="dialog_element" class="overlay"></label>
		<article class="elements">
			<section class="content">
				<table class="" data-bind="foreach: workspace.drawings">
					<tr>
						<td class=""><span data-bind="text: $index()+1"></span></td>
						<td class="name"><span data-bind="text: name"></span></td>
						<td class=""><span >xxx</span></td>
						<td class=""><span >yyy</span></td>
						<td class=""><span >anchor</span></td>
						<td class="color">color</td>
						<td class="settings"><button class="gray icon-sliders"></button></td>
						<td class="remove"><button class="error icon-trash" data-bind="click: ()=>{workspaceRemoveDrawing($data.id())}"></button></td>
					</tr>
				</table>
			</section>
			<footer class="right">
				<label for="dialog_element" class="button" >Close</label>
			</footer>
		</article>
	</div>

	<!-- task dialog -->
	<div class="modal">
		<input id="dialog_taskSettings" type="checkbox" />
		<label for="dialog_taskSettings" class="overlay"></label>
		<article class="taskSettings">
			<section class="content">
				<form data-bind="with: selectedTask">
					<input class="name" input="text" placeholder="Task Name" data-bind="value: name" />
					<table>
						<tr>
							<td class="parameter">color</td>
							<td>
								<label class="colorSelect" style="color: #222">
									<input type="checkbox" value="black" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: red">
									<input type="checkbox" value="red" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: green">
									<input type="checkbox" value="green" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: blue">
									<input type="checkbox" value="blue" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: #DA0">
									<input type="checkbox" value="yellow" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: #0DA">
									<input type="checkbox" value="cyan" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
								<label class="colorSelect" style="color: #D0A">
									<input type="checkbox" value="magenta" data-bind="checked: colors" />
									<span class="checkable"><i class="icon-brush large"></i></span>
								</label>
							</td>
						</tr>
						<tr>
							<td class="parameter">type</td>
							<td>
								<label class="typeSelect" >
									<input name="typeSelect" type="radio" value="vector"  data-bind="checked: type"/>
									<span class="checkable"><i class="icon-lines large"></i></span>
								</label>
								<label class="typeSelect" >
									<input name="typeSelect" type="radio" value="raster" data-bind="checked: type"/>
									<span class="checkable"><i class="icon-dots large"></i></span>
								</label>
							</td>
						</tr>

						<tr>
							<td class="parameter">speed</td>
							<td><input type="number" placeholder="10" min="0" data-bind="value: speed"></input> <span class="unit">mm/s</span></td>
						</tr>

						<tr>
							<td class="parameter">repeat</td>
							<td><input type="number" placeholder="1" min="1" data-bind="value: repeat"></input> <i class="icon-retweet large"></i></td>
						</tr>
					</table>
<!--
					<label>
						<input type="checkbox" checked /><span class="checkable parameter">message before task</span>
					</label>
					<textarea class="" placeholder="Task Message ..."></textarea>
-->					
				</form>
			</section>
			<footer>
				<div class="flex two">
					<div>
						<label for="dialog_taskSettings" class="button error">Cancel</label>
					</div>
					<div class="right">
						<label for="dialog_taskSettings" class="button success" data-bind="click: taskSaveParams">OK</label>
					</div>
				</div>
			</footer>
		</article>
	</div>

	<script type='text/javascript'>
		init();
	</script>
</body>
</html>
